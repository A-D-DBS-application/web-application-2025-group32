{% extends "base.html" %}

{% block title %}Reservaties Beheren - Admin{% endblock %}

{% block hero %}
<h1 style="font-size: 38px; font-weight: 800; margin: 0; letter-spacing: -0.5px;">Reservaties Beheren</h1>
<p style="color: var(--text-light); margin-top: 8px;">Ingelogd als: {{ user.user_name }} {{ user.user_last_name }} (Admin)</p>
{% endblock %}

{% block content %}
<div style="margin-bottom: 24px; display: flex; gap: 12px; align-items: center;">
    <a href="{{ url_for('home') }}" class="btn btn-ghost">Terug naar Home</a>
    <a href="{{ url_for('main.admin_create_reservation') }}" class="btn">Nieuwe Reservatie Aanmaken</a>
    {% if suspicious_count > 0 %}
    <div style="background: #fff3cd; border: 1px solid #ffc107; padding: 8px 16px; border-radius: 6px; margin-left: auto;">
        <span style="color: #856404; font-weight: 600;">⚠️ {{ suspicious_count }} verdachte reservatie{{ 's' if suspicious_count != 1 else '' }}</span>
    </div>
    {% endif %}
</div>

<div class="card">
    <h2 style="margin-top: 0;">Alle Toekomstige Reservaties</h2>
    
    {% if reservations %}
        <div style="overflow-x: auto;">
            <table style="table-layout: fixed; width: 100%; min-width: 1100px;">
                <colgroup>
                    <col style="width: 60px;">
                    <col style="width: 150px;">
                    <col style="width: 180px;">
                    <col style="width: 70px;">
                    <col style="width: 70px;">
                    <col style="width: 80px;">
                    <col style="width: 110px;">
                    <col style="width: 80px;">
                    <col style="width: 80px;">
                    <col style="width: 180px;">
                </colgroup>
                <thead>
                    <tr>
                        <th style="text-align: center; font-size: 13px;">Status</th>
                        <th style="font-size: 13px;">Gebruiker</th>
                        <th style="font-size: 13px;">Email</th>
                        <th style="text-align: center; font-size: 13px;">Bureau</th>
                        <th style="text-align: center; font-size: 13px;">Gebouw</th>
                        <th style="text-align: center; font-size: 13px;">Verdieping</th>
                        <th style="font-size: 13px; padding-left: 20px;">Datum</th>
                        <th style="font-size: 13px;">Starttijd</th>
                        <th style="font-size: 13px;">Eindtijd</th>
                        <th style="text-align: center; font-size: 13px;">Acties</th>
                    </tr>
                </thead>
                <tbody>
                    {% for res in reservations %}
                    <tr {% if res.is_suspicious %}style="background-color: #fff3cd;"{% endif %}>
                        <td style="text-align: center;">
                            {% if res.is_suspicious %}
                            <span title="{{ res.suspicious_reasons|join(', ') }}" style="cursor: help; font-size: 20px;">⚠️</span>
                            {% else %}
                            <span style="color: #28a745; font-size: 18px;">✓</span>
                            {% endif %}
                        </td>
                        <td style="font-weight: 600; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ res.user_name }} {{ res.user_last_name }}</td>
                        <td style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ res.user_email }}</td>
                        <td style="text-align: center; font-weight: 600;">{{ res.desk_number }}</td>
                        <td style="text-align: center; font-weight: 600;">{{ res.building_adress }}</td>
                        <td style="text-align: center;">{{ res.building_floor if res.building_floor is not none else '-' }}</td>
                        <td style="white-space: nowrap; padding-left: 20px;">{{ res.starttijd.strftime('%d/%m/%Y') }}</td>
                        <td>{{ res.starttijd.strftime('%H:%M') }}</td>
                        <td>{{ res.eindtijd.strftime('%H:%M') }}</td>
                        <td style="padding: 16px; text-align: center;">
                            <div style="display: flex; gap: 8px; justify-content: center; flex-wrap: nowrap;">
                                <a href="{{ url_for('main.admin_edit_reservation', res_id=res.res_id) }}" 
                                   style="background: #ff6200; color: white; padding: 6px 14px; border-radius: 10px; text-decoration: none; display: inline-block; font-weight: 700; font-size: 15px; transition: all 0.2s; box-shadow: 0 2px 8px rgba(255,98,0,0.2);">
                                    Wijzigen
                                </a>
                                <form method="POST" action="{{ url_for('main.admin_delete_reservation', res_id=res.res_id) }}" style="display: inline-block; margin: 0;">
                                    <button type="submit" 
                                            onclick="return confirm('Weet je zeker dat je deze reservatie wilt verwijderen?')"
                                            style="background: #f44336; color: white; padding: 6px 12px; border-radius: 10px; border: none; cursor: pointer; font-family: inherit; font-weight: 700; font-size: 15px; transition: all 0.2s; box-shadow: 0 2px 8px rgba(244,67,54,0.2);">
                                        Verwijder
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% if res.is_suspicious %}
                    <tr {% if res.is_suspicious %}style="background-color: #fff3cd;"{% endif %}>
                        <td colspan="10" style="padding: 8px 16px; font-size: 13px; color: #856404;">
                            <strong>Verdachte redenen:</strong>
                            {% for reason in res.suspicious_reasons %}
                                <span style="margin-right: 12px;">• {{ reason }}</span>
                            {% endfor %}
                        </td>
                    </tr>
                    {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p style="color: var(--muted); text-align: center; padding: 40px 0;">Geen toekomstige reservaties gevonden.</p>
    {% endif %}
</div>
{% endblock %}